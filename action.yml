name: Silverstripe CMS PHPUnit tests
description: Run PHPUnit test for a Siverstripe CMS module
inputs:
  phpVersion:
    description: PHP Version to run the test against
    required: true
    default: 7.4
  databaseDriver:
    description: Which Database to use
    required: true
    default: mysql
  composer-stability:
    description: composer stability flag
    required: true
    default: ''

runs:
  using: "composite"
  steps:
    - name: Run test suite
      env:
        SS_ENVIRONMENT_TYPE: dev
        SS_DATABASE_CLASS: ${{ env.SS_DATABASE_CLASS }}
        SS_DATABASE_SERVER: ${{ env.SS_DATABASE_SERVER }}
        SS_DATABASE_USERNAME: ${{ env.SS_DATABASE_USERNAME }}
        SS_DATABASE_PASSWORD: ${{ env.SS_DATABASE_PASSWORD }}
        SS_DATABASE_NAME: ${{ env.SS_DATABASE_NAME }}
      run: vendor/bin/phpunit
      shell: bash
